openapi: 3.0.3
info:
  title: Ballard Trucks API
  version: 0.1.0
  description: |
    Phase 1/2 backend API contract.
    All schedule query windows are UTC and hour-bucketed.
servers:
  - url: http://localhost:8080
paths:
  /api/health:
    get:
      summary: Health check
      operationId: getHealth
      responses:
        "200":
          description: Service is healthy
          content:
            text/plain:
              schema:
                type: string
                example: OK

  /api/breweries:
    get:
      summary: List breweries
      operationId: listBreweries
      responses:
        "200":
          description: Breweries
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/Brewery"

  /api/vendors:
    get:
      summary: List food vendors
      operationId: listVendors
      responses:
        "200":
          description: Food vendors
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/Vendor"

  /api/schedules:
    get:
      summary: Query schedule entries
      description: |
        Returns up to 100 matching rows. Unknown brewery or vendor IDs are valid
        and simply produce zero matches. Pagination is deferred to Phase 7.
      operationId: listSchedules
      parameters:
        - name: start_hour_utc
          in: query
          required: true
          description: UTC hour bucket formatted as `YYYY-MM-DDTHH`.
          schema:
            type: string
            pattern: "^[0-9]{4}-[0-9]{2}-[0-9]{2}T[0-9]{2}$"
            example: "2026-02-18T00"
        - name: duration_hours
          in: query
          required: true
          description: Query window size in hours.
          schema:
            type: integer
            minimum: 1
            example: 24
        - name: brewery_ids
          in: query
          required: false
          description: Optional comma-separated brewery IDs.
          style: form
          explode: false
          schema:
            type: array
            items:
              type: string
              format: uuid
        - name: vendor_ids
          in: query
          required: false
          description: Optional comma-separated vendor IDs.
          style: form
          explode: false
          schema:
            type: array
            items:
              type: string
              format: uuid
      responses:
        "200":
          description: Matching schedule entries (max 100)
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/ScheduleEntry"
        "400":
          description: Invalid query parameters
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"

components:
  schemas:
    Brewery:
      type: object
      required:
        - id
        - name
        - address
        - lat
        - lng
      properties:
        id:
          type: string
          format: uuid
        name:
          type: string
        address:
          type: string
        lat:
          type: number
          format: double
        lng:
          type: number
          format: double
        website:
          type: string
          format: uri
          nullable: true

    Vendor:
      type: object
      required:
        - id
        - name
      properties:
        id:
          type: string
          format: uuid
        name:
          type: string
        website:
          type: string
          format: uri
          nullable: true

    ScheduleEntry:
      type: object
      required:
        - id
        - brewery_id
        - brewery_name
        - vendor_id
        - vendor_name
        - start_at
        - end_at
        - source
        - updated_at
      properties:
        id:
          type: string
          format: uuid
        brewery_id:
          type: string
          format: uuid
        brewery_name:
          type: string
        vendor_id:
          type: string
          format: uuid
        vendor_name:
          type: string
        start_at:
          type: string
          format: date-time
          description: UTC RFC3339 timestamp.
        end_at:
          type: string
          format: date-time
          description: UTC RFC3339 timestamp.
        source:
          type: string
        updated_at:
          type: string
          format: date-time
          description: UTC RFC3339 timestamp.

    Error:
      type: object
      required:
        - error
      properties:
        error:
          type: string
